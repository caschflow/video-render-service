# ğŸ¬ Video Render API - Servicio de Renderizado

API para combinar video + audio usando FFmpeg en contenedor Docker.

## ğŸ“ Estructura de Archivos

Necesitas estos archivos en tu repositorio:

```
/
â”œâ”€â”€ Dockerfile           # Imagen del contenedor
â”œâ”€â”€ docker-compose.yml   # ConfiguraciÃ³n de servicios
â”œâ”€â”€ render_api.py        # API principal
â””â”€â”€ README.md           # Este archivo
```

## ğŸš€ Despliegue en Render

### Paso 1: Preparar Archivos
1. Crea un repositorio Git con los 3 archivos principales
2. Sube todos los archivos a tu repositorio

### Paso 2: Configurar Render
1. Ve a [Render.com](https://render.com) 
2. Conecta tu repositorio
3. Crear **Web Service** con estas configuraciones:

```yaml
Service Type: Web Service
Build Command: docker build -t video-render .
Start Command: docker run -p 8080:8080 video-render
```

### Paso 3: Variables de Entorno (Opcionales)
```
FFMPEG_THREADS=3
MAX_CONCURRENT_JOBS=2
```

## ğŸ”§ Endpoints de la API

### Health Check
```http
GET /health
```
Respuesta:
```json
{
  "status": "healthy",
  "system": {
    "cpu_usage": "25%",
    "memory_usage": "45%",
    "active_jobs": 1
  }
}
```

### Crear Trabajo de Render
```http
POST /render
Content-Type: application/json

{
  "video_url": "https://example.com/video.mp4",
  "audio_url": "https://example.com/audio.wav",
  "quality": "high"
}
```

Respuesta:
```json
{
  "job_id": "abc12345",
  "status": "pending"
}
```

### Verificar Estado
```http
GET /status/{job_id}
```

### Descargar Video Final
```http
GET /download/render_{job_id}.mp4
```

## ğŸ¯ Uso desde n8n

### 1. Crear Trabajo
```javascript
// HTTP Request Node
const response = await this.helpers.httpRequest({
  method: 'POST',
  url: 'https://your-render-app.onrender.com/render',
  body: {
    video_url: items[0].json.video_url,
    audio_url: items[0].json.audio_url,
    quality: 'high'
  },
  json: true
});

return [{ json: { job_id: response.job_id } }];
```

### 2. Verificar Estado
```javascript
// Wait Node + HTTP Request Loop
const jobId = items[0].json.job_id;
const status = await this.helpers.httpRequest({
  method: 'GET',
  url: `https://your-render-app.onrender.com/status/${jobId}`,
  json: true
});

return [{ json: status }];
```

### 3. Descargar Video
```javascript
// Cuando status === "completed"
const downloadUrl = `https://your-render-app.onrender.com/download/render_${jobId}.mp4`;
return [{ json: { download_url: downloadUrl } }];
```

## âš¡ CaracterÃ­sticas

- âœ… **Procesamiento AsÃ­ncrono**: Trabajos en background
- âœ… **Control de Concurrencia**: MÃ¡ximo 2 trabajos simultÃ¡neos
- âœ… **MÃºltiples Calidades**: High, Medium, Low
- âœ… **Health Check**: Monitoreo de sistema
- âœ… **Logs Detallados**: Para debugging
- âœ… **Limpieza AutomÃ¡tica**: Archivos temporales
- âœ… **Timeouts**: Evita trabajos colgados

## ğŸ” SoluciÃ³n de Problemas

### Error "sh: syntax error"
âœ… **SOLUCIONADO**: Usando Dockerfile separado

### Verificar Logs
```bash
# En desarrollo local
docker-compose logs -f video-render-service

# En Render
Check "Logs" tab en tu servicio
```

### Verificar Health
```bash
curl https://your-app.onrender.com/health
```

## ğŸ“Š Monitoreo

La API incluye mÃ©tricas de sistema:
- CPU y memoria usage
- Trabajos activos/completados
- Espacio en disco
- VersiÃ³n de FFmpeg

## ğŸ›¡ï¸ LÃ­mites y Consideraciones

- **CPU**: 3 cores dedicados
- **RAM**: 12GB lÃ­mite
- **Trabajos simultÃ¡neos**: 2 mÃ¡ximo
- **Timeout**: 60s para descargas
- **Almacenamiento**: Limpieza automÃ¡tica de temporales

Tu servicio estarÃ¡ disponible en: `https://your-app.onrender.com`
